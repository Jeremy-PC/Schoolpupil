!function(t,e){"function"==typeof define&&define.amd?define(["exports","b"],e):"object"==typeof exports&&"string"!=typeof exports.nodeName?e(exports,require("b")):e(t.commonJsStrict={},t.b)}(this,function(exports,t){function e(t){if(t in S)return t;for(var e=t[0].toUpperCase()+t.slice(1),n=R.length;n--;)if(t=R[n]+e,t in S)return t}function n(t){t=t||{};for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var o in i)i.hasOwnProperty(o)&&("object"==typeof i[o]?t[o]=n({},i[o]):t[o]=i[o])}return t}function i(t,e,n){var i;return function(){var o=this,r=arguments,a=function(){i=null,n||t.apply(o,r)},s=n&&!i;clearTimeout(i),i=setTimeout(a,e),s&&t.apply(o,r)}}function o(t){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("change",!1,!0),t.dispatchEvent(e)}else t.fireEvent("onchange")}function r(t,e,n){if("string"==typeof e){var i=e;e={},e[i]=n}for(var o in e)t.style[o]=e[o]}function a(t){var e=t.points,n=document.createElement("div"),i=document.createElement("img"),o=e[2]-e[0],a=e[3]-e[1];return n.classList.add("croppie-result"),n.appendChild(i),r(i,{left:-1*e[0]+"px",top:-1*e[1]+"px"}),i.src=t.imgSrc,r(n,{width:o+"px",height:a+"px"}),n}function s(t,e){var n=e.points,i=n[0],o=n[1],r=n[2]-n[0],a=n[3]-n[1],s=e.circle,c=document.createElement("canvas"),l=c.getContext("2d");return c.width=r,c.height=a,s&&(l.save(),l.beginPath(),l.arc(r/2,a/2,r/2,0,2*Math.PI,!0),l.closePath(),l.clip()),l.drawImage(t,i,o,r,a,0,0,r,a),c.toDataURL()}function c(t){var e,n=new Image;return e=new Promise(function(e,i){n.onload=function(){e(n)},n.src=t})}function l(){var t=this,e=["croppie-container"],n=t.boundary=document.createElement("div"),i=t.viewport=document.createElement("div"),o=t.img=document.createElement("img"),a=t.overlay=document.createElement("div"),s=t.options.viewport.type?"cr-vp-"+t.options.viewport.type:null;n.classList.add("cr-boundary"),r(n,{width:t.options.boundary.width+"px",height:t.options.boundary.height+"px"}),i.classList.add("cr-viewport"),s&&i.classList.add(s),r(i,{width:t.options.viewport.width+"px",height:t.options.viewport.height+"px"}),o.classList.add("cr-image"),a.classList.add("cr-overlay"),t.element.appendChild(n),n.appendChild(o),n.appendChild(i),n.appendChild(a),t.element.classList.add(e),t.options.customClass&&t.element.classList.add(t.options.customClass),h.call(this),t.options.showZoom&&p.call(t)}function p(){function t(){m.call(a),i=new Z(a.img),o=a.viewport.getBoundingClientRect(),r=B.parse(a.img)}function e(){u.call(a,{value:parseFloat(c.value),origin:i||new Z(a.img),viewportRect:o||a.viewport.getBoundingClientRect(),transform:r||B.parse(a.img)})}function n(n){var i=n.deltaY/-2e3,o=a._currentZoom+i;n.preventDefault(),t(),c.value=o,e()}var i,o,r,a=this,s=document.createElement("div"),c=a.zoomer=document.createElement("input");s.classList.add("cr-slider-wrap"),c.type="range",c.classList.add("cr-slider"),c.step="0.01",c.value=1,a.element.appendChild(s),s.appendChild(c),a._currentZoom=1,a.zoomer.addEventListener("mousedown",t),a.zoomer.addEventListener("touchstart",t),a.zoomer.addEventListener("input",e),a.zoomer.addEventListener("change",e),a.options.mouseWheelZoom&&(a.boundary.addEventListener("mousewheel",n),a.boundary.addEventListener("DOMMouseScroll",n))}function u(t){var e=this,n=t.transform,i=t.viewportRect,o=t.origin;e._currentZoom=t.value,n.scale=e._currentZoom;var a=d.call(e,i),s=a.translate,c=a.origin;n.x>=s.maxX&&(o.x=c.minX,n.x=s.maxX),n.x<=s.minX&&(o.x=c.maxX,n.x=s.minX),n.y>=s.maxY&&(o.y=c.minY,n.y=s.maxY),n.y<=s.minY&&(o.y=c.maxY,n.y=s.minY);var l={};l[b]=n.toString(),l[L]=o.toString(),r(e.img,l),_.call(e),v.call(e)}function d(t){var e=this,n=e._currentZoom,i=t.width,o=t.height,r=e.options.boundary.width/2,a=e.options.boundary.height/2,s=e._originalImageWidth,c=e._originalImageHeight,l=s*n,p=c*n,u=i/2,d=o/2,m=-1*(u/n-r),h=m-(l*(1/n)-i*(1/n)),g=-1*(d/n-a),v=g-(p*(1/n)-o*(1/n)),f=1/n*u,w=l*(1/n)-f,y=1/n*d,x=p*(1/n)-y;return{translate:{maxX:m,minX:h,maxY:g,minY:v},origin:{maxX:w,minX:f,maxY:x,minY:y}}}function m(){var t=this,e=t._currentZoom,n=t.img.getBoundingClientRect(),i=t.viewport.getBoundingClientRect(),o=B.parse(t.img.style[b]),a=new Z(t.img),s=i.top-n.top+i.height/2,c=i.left-n.left+i.width/2,l={},p={};l.y=s/e,l.x=c/e,p.y=(l.y-a.y)*(1-e),p.x=(l.x-a.x)*(1-e),o.x-=p.x,o.y-=p.y;var u={};u[L]=l.x+"px "+l.y+"px",u[b]=o.toString(),r(t.img,u)}function h(){function t(t){t.preventDefault(),p||(p=!0,i=t.pageX,a=t.pageY,transform=B.parse(l.img),window.addEventListener("mousemove",e),window.addEventListener("touchmove",e),window.addEventListener("mouseup",n),window.addEventListener("touchend",n),document.body.style[Y]="none",c=l.viewport.getBoundingClientRect())}function e(t){t.preventDefault();var e=t.pageX||t.touches[0].pageX,n=t.pageY||t.touches[0].pageY,p=e-i,u=n-a,d=l.img.getBoundingClientRect(),m=transform.y+u,h=transform.x+p,v={};if("touchmove"==t.type&&t.touches.length>1){var f=t.touches[0],w=t.touches[1],y=Math.sqrt((f.pageX-w.pageX)*(f.pageX-w.pageX)+(f.pageY-w.pageY)*(f.pageY-w.pageY));s||(s=y/l._currentZoom);var x=y/s;return l.zoomer.value=x,void o(l.zoomer)}c.top>d.top+u&&c.bottom<d.bottom+u&&(transform.y=m),c.left>d.left+p&&c.right<d.right+p&&(transform.x=h),v[b]=transform.toString(),r(l.img,v),g.call(l),a=n,i=e}function n(t){p=!1,window.removeEventListener("mousemove",e),window.removeEventListener("touchmove",e),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),document.body.style[Y]="none",m.call(l),v.call(l),s=0}var i,a,s,c,l=this,p=!1;l.overlay.addEventListener("mousedown",t),l.overlay.addEventListener("touchstart",t)}function g(){var t=this,e=t.boundary.getBoundingClientRect(),n=t.img.getBoundingClientRect();r(t.overlay,{width:n.width+"px",height:n.height+"px",top:n.top-e.top+"px",left:n.left-e.left+"px"})}function v(){var t=this;t.options.update.call(t,t.get())}function f(){var t,e,n=this,i=n.img.getBoundingClientRect(),r=n.viewport.getBoundingClientRect(),a=0,s=1.5,c=1;n._originalImageWidth=i.width,n._originalImageHeight=i.height,n.options.showZoom&&(t=r.width/i.width,e=r.height/i.height,a=Math.max(t,e),a>s&&(s=a+1,c=a+(s-a)/2),n.zoomer.min=a,n.zoomer.max=s,n.zoomer.value=c,o(n.zoomer)),g.call(n)}function w(t){if(4!=t.length)throw"Croppie - Invalid number of points supplied: "+t;var e=this,n=t[2]-t[0],i=e.viewport.getBoundingClientRect(),o=e.boundary.getBoundingClientRect(),a={left:i.left-o.left,top:i.top-o.top},s=i.width/n,c=t[1],l=t[0],p=-1*t[1]+a.top,u=-1*t[0]+a.left,d={};d[L]=l+"px "+c+"px",d[b]=new B(u,p,s).toString(),r(e.img,d),e.zoomer.value=s,e._currentZoom=s}function y(t,e){var n,i=this,o=[];"string"==typeof t?(n=t,t={}):(n=t.url,o=t.points||[]),i.imgSrc=n;var r=c(n);return r.then(function(){i.img.src=n,f.call(i),o.length&&w.call(i,o),v.call(i),e&&e()}),r}function x(){var t=this,e=t.img.getBoundingClientRect(),n=t.viewport.getBoundingClientRect(),i=n.left-e.left,o=n.top-e.top,r=i+n.width,a=o+n.height,s=t._currentZoom;return i/=s,r/=s,o/=s,a/=s,{points:[i,o,r,a],zoom:s}}function E(t){var e,n=this,i=x.call(n);return i.circle="circle"===n.options.viewport.type,i.imgSrc=n.imgSrc,t=t||"html",e=new Promise(function(e,o){"canvas"===t?c(n.imgSrc).then(function(t){e(s(t,i))}):e(a(i))})}function C(t,e){this.element=t,this.options=n({},C.defaults,e),l.call(this)}var L,b,Y,R=["Webkit","Moz","ms"],S=document.createElement("div").style;b=e("transform"),L=e("transformOrigin"),Y=e("userSelect");var X="translate3d",z=", 0px",B=function(t,e,n){this.x=parseFloat(t),this.y=parseFloat(e),this.scale=parseFloat(n)};B.parse=function(t){return t.style?B.parse(t.style[b]):t.indexOf("matrix")>-1||t.indexOf("none")>-1?B.fromMatrix(t):B.fromString(t)},B.fromMatrix=function(t){var e=t.substring(7).split(",");return e.length&&"none"!==t||(e=[1,0,0,1,0,0]),new B(parseInt(e[4],10),parseInt(e[5],10),parseFloat(e[0]))},B.fromString=function(t){var e=t.split(") "),n=e[0].substring(X.length+1).split(","),i=e.length>1?e[1].substring(6):1,o=n.length>1?n[0]:0,r=n.length>1?n[1]:0;return new B(o,r,i)},B.prototype.toString=function(){return X+"("+this.x+"px, "+this.y+"px"+z+") scale("+this.scale+")"};var Z=function(t){if(!t||!t.style[L])return this.x=0,void(this.y=0);var e=t.style[L].split(" ");this.x=parseFloat(e[0]),this.y=parseFloat(e[1])};Z.prototype.toString=function(){return this.x+"px "+this.y+"px"};var _=i(g,500);if(this.jQuery){var $=this.jQuery;$.fn.croppie=function(t){var e=typeof t;if("string"===e){var n=Array.prototype.slice.call(arguments,1),i=$(this).data("croppie");return"get"===t?i.get():"result"===t?i.result.apply(i,n):this.each(function(){var e=$(this).data("croppie");if(e){var i=e[t];if(!$.isFunction(i))throw"Croppie "+t+" method not found";i.apply(e,n)}})}return this.each(function(){var e=new C(this,t);$(this).data("croppie",e)})}}C.defaults={viewport:{width:100,height:100,type:"square"},boundary:{width:300,height:300},customClass:"",showZoom:!0,mouseWheelZoom:!0,update:function(){}},n(C.prototype,{bind:function(t,e){return y.call(this,t,e)},get:function(){return x.call(this)},result:function(t){return E.call(this,t)}}),exports.Croppie=window.Croppie=C});